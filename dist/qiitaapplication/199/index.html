<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>wp-app</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="## Build Setup"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/runtime.8b17cd4.js" as="script"><link rel="preload" href="/_nuxt/vendors/commons.ca01d4b.js" as="script"><link rel="preload" href="/_nuxt/app.1984cc1.js" as="script"><link rel="preload" href="/_nuxt/pages/_slug/_id.b892f06.js" as="script"><style data-vue-ssr-id="fa7ff0ca:0 56b15182:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.button--green{display:inline-block;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}</style><link rel="preload" href="/_nuxt/static/1598415284/qiitaapplication/199/payload.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div><div class="post"><h1>QiitaAPIとの連携</h1> <div class="content"><h4>QiitaAPIについて</h4>
<a rel="noopener noreferrer" href="https://qiita.com/api/v2/docs" title="Qiita API v2 documentation - Qiita:Developer" class="blogcard-wrap external-blogcard-wrap a-wrap cf" target="_blank"><div class="blogcard external-blogcard eb-left cf"><div class="blogcard-label external-blogcard-label"><span class="fa"></span></div><figure class="blogcard-thumbnail external-blogcard-thumbnail"><img src="https://www.komugirice.com/wp-content/uploads/cocoon-resources/blog-card-cache/ebc22d959970cde46bec72d56f86fcc9.png" alt="" class="blogcard-thumb-image external-blogcard-thumb-image" width="320" height="180"></figure><div class="blogcard-content external-blogcard-content"><div class="blogcard-title external-blogcard-title">Qiita API v2 documentation - Qiita:Developer</div><div class="blogcard-snippet external-blogcard-snippet">Official API documantation of Qiita API v2.</div></div><div class="blogcard-footer external-blogcard-footer cf"><div class="blogcard-site external-blogcard-site"><div class="blogcard-favicon external-blogcard-favicon"><img src="//www.google.com/s2/favicons?domain=qiita.com" class="blogcard-favicon-image" alt="" width="16" height="16"></div><div class="blogcard-domain external-blogcard-domain">qiita.com</div></div></div></div></a>
<div class="mb60"> </div>
<p class="filename">QiitaResponse.kt</p>
<p>QiitaResponse.ktにAPIのレスポンスデータを定義した</p>
<div class="mb20 clearfix"></div>
<p class="filename">QiitaApi.kt</p>
<p>retrofitを使用してQiitaApiを実装した</p>
<p class="filename">ベース</p>


<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="20" data-enlighter-title="" data-enlighter-group="">    fun retrofitApi(client: OkHttpClient): Retrofit =
        Retrofit.Builder()
            .client(client)
            .baseUrl("https://qiita.com/api/v2/")
            .addConverterFactory(create())
            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
            .build()

    fun retrofitApi(): Retrofit =
        Retrofit.Builder()
            .baseUrl("https://qiita.com/api/v2/")
            .addConverterFactory(create())
            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
            .build()
</pre>


<p><a rel="noopener noreferrer" href="https://qiita.com/api/v2/docs#get-apiv2items" target="_blank"><br>https://qiita.com/api/v2/docs#get-apiv2items<br></a>のinterface</p>


<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="35" data-enlighter-title="" data-enlighter-group="">    interface ItemsIF {
        // @GET("items?page={page}&per_page=20")
        @GET("items")
        fun getItem(@Query("page") page: Int, @Query("per_page") perPage: Int = 20) : Observable&lt;List&lt;QiitaResponse>>

        //@GET("items?page={page}&per_page=20&query=body:{encodeQuery}")
        @GET("items")
        fun searchBody(@Query("page") page: Int, @Query("query") encodeQuery: String
                       , @Query("per_page") perPage: Int = 20) : Observable&lt;List&lt;QiitaResponse>>

    }</pre>


<p><a rel="noopener noreferrer" href="https://qiita.com/api/v2/docs#get-apiv2tagstag_iditems" target="_blank"><br>https://qiita.com/api/v2/docs#get-apiv2tagstag_iditems<br></a>のinterface</p>


<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="47" data-enlighter-title="" data-enlighter-group="">    interface TagsIF {
        @GET("tags/{encodeQuery}/items")
        fun searchTag(@Path("encodeQuery", encoded=true) encodeQuery: String, @Query("page") page: Int
                      , @Query("per_page") perPage: Int = 20): Observable&lt;List&lt;QiitaResponse>>
    }</pre>


<p>encodeしなければ日本語が文字化けするのでご注意を</p>
<div class="mb60"> </div>
<p class="filename">ArticleViewModel.kt</p>


<p>RxJava2を使用してAPIを実行する</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="39" data-enlighter-title="" data-enlighter-group="">   fun updateData(page: Int, isFavorite: Boolean, isAdd: Boolean = false) {
        QiitaApi.itemsIF.getItem(page)
            .observeOn(AndroidSchedulers.mainThread())
            .subscribeOn(Schedulers.io())
            .subscribe({
                var articleRowList : MutableList&lt;ArticleRow>  = mutableListOf()
                it.forEach({
                        resp ->
                    val row =
                        ArticleRow()
                    row.convertFromQiitaResponse(resp)
                    articleRowList.add(row)
                })
                // 取得データ反映
                setItems(articleRowList, isFavorite, isAdd)

            }, {
                currentPage = page
                isAddPrev = isAdd

                //items.postValue(listOf())
                isException.postValue(it)

            })

    }</pre>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="66" data-enlighter-title="" data-enlighter-group="">    /**
     * setItems
     *
     * @param articleRowList
     * @param isFavorite
     * @param isAdd
     *
     */
    fun setItems(articleRowList : MutableList&lt;ArticleRow>, isFavorite: Boolean, isAdd: Boolean = false) {

        // 引数：articleRowList → ArticleAdapter.QiitaDataにコンバート
        val qiitaList : MutableList&lt;ArticleAdapter.QiitaData> = mutableListOf()
        articleRowList.forEach({ row -> qiitaList.add(ArticleAdapter.QiitaData(row, isFavorite))})

        // 引数：isAddによってデータ追加orクリア
        val tempList = mutableListOf&lt;ArticleAdapter.QiitaData>()
        if (isAdd)
            tempList.addAll(items.value ?: listOf())
        tempList.addAll(qiitaList)
        items.postValue(tempList)
    }</pre>
</div></div></div></div></div></div><script>window.__NUXT__={staticAssetsBase:"/_nuxt/static/1598415284",layout:"default",error:null,serverRendered:!0,routePath:"/qiitaapplication/199/",config:{}}</script><script src="/_nuxt/runtime.8b17cd4.js" defer></script><script src="/_nuxt/pages/_slug/_id.b892f06.js" defer></script><script src="/_nuxt/vendors/commons.ca01d4b.js" defer></script><script src="/_nuxt/app.1984cc1.js" defer></script>
  </body>
</html>
